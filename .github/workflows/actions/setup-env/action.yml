
name: 'Configuration des variables d''environnement'
description: 'Configure les variables d''environnement pour le dÃ©ploiement'

inputs:
  openai-api-key:
    description: 'ClÃ© API OpenAI'
    required: true
  google-cloud-project:
    description: 'ID du projet Google Cloud'
    required: true
  working-directory:
    description: 'RÃ©pertoire de travail'
    required: true

runs:
  using: 'composite'
  steps:
    - name: Configuration des variables d'environnement
      shell: bash
      working-directory: ${{ inputs.working-directory }}
      run: |
        echo "ğŸ”§ Configuration des variables d'environnement..."
        
        # CrÃ©er le fichier .env dans le rÃ©pertoire de travail
        echo "NODE_ENV=production" > .env
        
        if [ -n "${{ inputs.openai-api-key }}" ]; then
          echo "âœ… Configuration de OPENAI_API_KEY"
          echo "OPENAI_API_KEY=${{ inputs.openai-api-key }}" >> .env
        else
          echo "âŒ ERREUR: OPENAI_API_KEY manquante"
          exit 1
        fi
        
        if [ -n "${{ inputs.google-cloud-project }}" ]; then
          echo "âœ… Configuration de GOOGLE_CLOUD_PROJECT"
          echo "GOOGLE_CLOUD_PROJECT=${{ inputs.google-cloud-project }}" >> .env
        else
          echo "âŒ ERREUR: GOOGLE_CLOUD_PROJECT manquant"
          exit 1
        fi
        
        echo "âœ… Variables d'environnement configurÃ©es avec succÃ¨s dans $(pwd)/.env"
        echo "ğŸ“‹ Contenu du fichier .env (sans les valeurs sensibles):"
        grep -v "OPENAI_API_KEY" .env | cat -n
