
name: "Installation des dÃ©pendances"
description: "Installe les dÃ©pendances npm"

inputs:
  working-directory:
    description: "RÃ©pertoire de travail"
    required: true

runs:
  using: "composite"
  steps:
    - name: Installation des dÃ©pendances
      shell: bash
      working-directory: ${{ inputs.working-directory }}
      run: |
        echo "ğŸ”§ PrÃ©paration de l'installation..."
        
        # VÃ©rifier la prÃ©sence de package.json
        if [ ! -f "package.json" ]; then
          echo "âŒ package.json non trouvÃ© dans $(pwd)"
          exit 1
        fi
        
        # Nettoyer le cache npm et node_modules
        echo "ğŸ§¹ Nettoyage des dÃ©pendances existantes..."
        rm -rf node_modules
        rm -f package-lock.json
        
        # Installation des dÃ©pendances avec plus de dÃ©tails
        echo "ğŸ“¦ Installation des dÃ©pendances..."
        npm install --no-package-lock --verbose
        
        # VÃ©rifier que firebase-admin est correctement installÃ©
        if [ -d "node_modules/firebase-admin" ]; then
          echo "âœ… firebase-admin est installÃ© avec succÃ¨s"
          ls -la node_modules/firebase-admin
        else
          echo "âŒ firebase-admin n'est PAS installÃ© correctement!"
          echo "Tentative d'installation explicite de firebase-admin..."
          npm install firebase-admin --save --no-package-lock
        fi
        
        if [ $? -ne 0 ]; then
          echo "âŒ Erreur lors de l'installation des dÃ©pendances"
          exit 1
        fi
        
        echo "âœ… DÃ©pendances installÃ©es avec succÃ¨s"
        echo "ğŸ“‹ Liste des dÃ©pendances principales installÃ©es:"
        npm list --depth=0
