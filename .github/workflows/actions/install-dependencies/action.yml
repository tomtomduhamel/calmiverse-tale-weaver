
name: "Installation des d√©pendances"
description: "Installe les d√©pendances npm"

inputs:
  working-directory:
    description: "R√©pertoire de travail"
    required: true

runs:
  using: "composite"
  steps:
    - name: Installation des d√©pendances
      shell: bash
      working-directory: ${{ inputs.working-directory }}
      run: |
        echo "üîß Pr√©paration de l'installation..."
        
        # V√©rifier la pr√©sence de package.json
        if [ ! -f "package.json" ]; then
          echo "‚ùå package.json non trouv√© dans $(pwd)"
          exit 1
        fi
        
        # Nettoyer le cache npm et node_modules
        echo "üßπ Nettoyage des d√©pendances existantes..."
        rm -rf node_modules
        rm -f package-lock.json
        
        # Installation des d√©pendances avec plus de d√©tails et for√ßant la production
        echo "üì¶ Installation des d√©pendances en mode PRODUCTION..."
        npm install --no-package-lock --verbose --production
        
        # V√©rifier que firebase-admin est correctement install√©
        if [ -d "node_modules/firebase-admin" ]; then
          echo "‚úÖ firebase-admin est install√© avec succ√®s"
          ls -la node_modules/firebase-admin
        else
          echo "‚ùå firebase-admin n'est PAS install√© correctement!"
          echo "Tentative d'installation explicite de firebase-admin..."
          npm install firebase-admin --save --no-package-lock
        fi
        
        # V√©rifier firebase-functions √©galement
        if [ -d "node_modules/firebase-functions" ]; then
          echo "‚úÖ firebase-functions est install√© avec succ√®s"
          ls -la node_modules/firebase-functions
        else
          echo "‚ùå firebase-functions n'est PAS install√© correctement!"
          echo "Installation explicite de firebase-functions..."
          npm install firebase-functions --save --no-package-lock
        fi
        
        # V√©rifier si l'installation a √©chou√©
        if [ $? -ne 0 ]; then
          echo "‚ùå Erreur lors de l'installation des d√©pendances"
          exit 1
        fi
        
        echo "‚úÖ D√©pendances install√©es avec succ√®s"
        echo "üìã Liste des d√©pendances principales install√©es:"
        npm list --depth=0 firebase-admin firebase-functions
