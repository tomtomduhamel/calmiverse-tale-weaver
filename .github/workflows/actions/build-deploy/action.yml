
name: 'Build et d√©ploiement'
description: 'Compile et d√©ploie les functions Firebase'

inputs:
  project-id:
    description: 'ID du projet Firebase'
    required: true
  firebase-token:
    description: 'Token Firebase CLI'
    required: true
  working-directory:
    description: 'R√©pertoire de travail'
    required: true

runs:
  using: 'composite'
  steps:
    - name: Build Functions v2
      shell: bash
      working-directory: ${{ inputs.working-directory }}
      run: |
        npm run build
        
        if [ $? -ne 0 ]; then
          echo "‚ùå ERREUR de compilation"
          exit 1
        fi
        echo "‚úÖ Build termin√© avec succ√®s"
    
    - name: D√©ploiement des Functions v2
      shell: bash
      working-directory: ${{ inputs.working-directory }}
      run: |
        echo "üöÄ D√©ploiement des fonctions v2 sur ${{ inputs.project-id }}"
        firebase deploy --only functions:v2 --project ${{ inputs.project-id }} --token "${{ inputs.firebase-token }}" --non-interactive --debug
