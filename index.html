<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>calmiverse-tale-weaver</title>
    <meta name="description" content="Lovable Generated Project" />
    <meta name="author" content="Lovable" />
    <meta property="og:image" content="/og-image.png" />
  </head>
  <body>
    <div id="root"></div>
    <script>
      // Configuration de base
      window.gptengineer = {
        config: {
          debug: true,
          retryDelay: 1000,
          maxRetries: 3
        }
      };

      // Gestionnaire d'erreurs simplifié
      const errorHandler = {
        handle(error, source) {
          // Ignorer les erreurs non critiques
          if (this.isNonCritical(error)) {
            console.info(`[${source}] Non-critical error:`, error);
            return false;
          }
          
          // Logger les erreurs critiques
          console.error(`[${source}] Critical error:`, error);
          return true;
        },

        isNonCritical(error) {
          const nonCriticalPatterns = [
            'cors',
            'feature',
            'ambient-light-sensor',
            'battery',
            'connection',
            'preload',
            'as',
            'link preloaded'
          ];

          return nonCriticalPatterns.some(pattern => 
            error?.message?.toLowerCase().includes(pattern)
          );
        }
      };

      // Gestionnaire d'erreurs global
      window.addEventListener('error', function(event) {
        if (event.target && (event.target.tagName === 'LINK' || event.target.tagName === 'SCRIPT')) {
          return false;
        }
        
        const shouldPropagate = errorHandler.handle(event.error, 'Global Error');
        if (!shouldPropagate) {
          event.preventDefault();
          return false;
        }
      }, true);

      // Gestionnaire de promesses rejetées
      window.addEventListener('unhandledrejection', function(event) {
        const shouldPropagate = errorHandler.handle(event.reason, 'Unhandled Promise');
        if (!shouldPropagate) {
          event.preventDefault();
          return false;
        }
      });

      // Initialisation de l'application
      window.addEventListener('load', function() {
        console.log('Application initialized');
      });
    </script>
    <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>